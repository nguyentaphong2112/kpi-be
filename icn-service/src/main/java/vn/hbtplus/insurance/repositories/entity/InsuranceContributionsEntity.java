/* * Copyright (C) 2022 HBTPlus. All rights reserved. * HBTPlus. Use is subject to license terms. */package vn.hbtplus.insurance.repositories.entity;import lombok.Data;import vn.hbtplus.exceptions.BaseAppException;import vn.hbtplus.insurance.models.ContributionParameterDto;import vn.hbtplus.repositories.entity.BaseEntity;import vn.hbtplus.utils.Utils;import javax.persistence.*;import java.util.Date;/** * Lop entity ung voi bang icn_insurance_contributions * * @author tudd * @version 1.0 * @since 1.0 */@Data@Entity@Table(name = "icn_insurance_contributions")public class InsuranceContributionsEntity extends BaseEntity implements Cloneable {    @Id    @GeneratedValue(strategy = GenerationType.IDENTITY)    @Basic(optional = false)    @Column(name = "insurance_contribution_id")    private Long insuranceContributionId;    @Column(name = "period_date")    @Temporal(TemporalType.DATE)    private Date periodDate;    @Column(name = "employee_id")    private Long employeeId;    @Column(name = "emp_type_code")    private String empTypeCode;    @Column(name = "labour_type")    private String labourType;    @Column(name = "job_id")    private Long jobId;    @Column(name = "org_id")    private Long orgId;    @Column(name = "contract_salary")    private Long contractSalary;    @Column(name = "reserve_salary")    private Long reserveSalary;    @Column(name = "pos_allowance_salary")    private Long posAllowanceSalary;    @Column(name = "seniority_salary")    private Long senioritySalary;    @Column(name = "pos_seniority_salary")    private Long posSenioritySalary;    @Column(name = "total_salary")    private Long totalSalary;    @Column(name = "per_social_amount")    private Long perSocialAmount;    @Column(name = "unit_social_amount")    private Long unitSocialAmount;    @Column(name = "per_medical_amount")    private Long perMedicalAmount;    @Column(name = "unit_medical_amount")    private Long unitMedicalAmount;    @Column(name = "per_unemp_amount")    private Long perUnempAmount;    @Column(name = "unit_unemp_amount")    private Long unitUnempAmount;    @Column(name = "unit_union_amount")    private Long unitUnionAmount;    @Column(name = "base_union_amount")    private Long baseUnionAmount;    @Column(name = "superior_union_amount")    private Long superiorUnionAmount;    @Column(name = "mod_union_amount")    private Long modUnionAmount;    @Column(name = "total_amount")    private Long totalAmount;    @Column(name = "status")    private String status;    @Column(name = "reason")    private String reason;    @Column(name = "note")    private String note;    @Column(name = "insurance_factor")    private Double insuranceFactor;    @Column(name = "insurance_base_salary")    private Long insuranceBaseSalary;    @Column(name = "reserve_factor")    private Double reserveFactor;    @Column(name = "allowance_factor")    private Double allowanceFactor;    @Column(name = "seniority_percent")    private Double seniorityPercent;    @Column(name = "pos_seniority_percent")    private Double posSeniorityPercent;    @Column(name = "insurance_timekeeping")    private Double insuranceTimekeeping;    @Column(name = "leave_timekeeping")    private Double leaveTimekeeping;    @Column(name = "leave_reason")    private String leaveReason;    @Column(name = "maternity_timekeeping")    private Double maternityTimekeeping;    @Column(name = "insurance_agency")    private String insuranceAgency;    @Column(name = "type")    private String type;    @Column(name = "reject_reason")    private String rejectReason;    @Column(name = "retro_for_period_date")    private Date retroForPeriodDate;    @Column(name = "retirement_social_amount")    private Long retirementSocialAmount;    @Column(name = "sickness_social_amount")    private Long sicknessSocialAmount;    @Column(name = "accident_social_amount")    private Long accidentSocialAmount;    @Column(name = "debit_org_id")    private Long debitOrgId;    public Long getDebitOrgId() {        return debitOrgId == null ? orgId : debitOrgId;    }    public void resetAmount() {        this.unitSocialAmount = 0l;        this.perSocialAmount = 0l;        this.unitMedicalAmount = 0l;        this.perMedicalAmount = 0l;        this.unitUnempAmount = 0l;        this.perUnempAmount = 0l;        this.unitUnionAmount = 0l;        this.totalAmount = 0l;        this.baseUnionAmount = 0l;        this.superiorUnionAmount = 0l;        this.modUnionAmount = 0l;        this.retirementSocialAmount = 0l;        this.sicknessSocialAmount = 0l;        this.accidentSocialAmount = 0l;    }    public interface TYPES {        String TRUY_THU = "TRUY_THU";        String TRUY_LINH = "TRUY_LINH";        String THAI_SAN = "THAI_SAN";        String THU_BHXH = "THU_BHXH";        String TRUY_THU_BHYT = "TRUY_THU_BHYT";        String KO_THU = "KO_THU";        String[] INSURANCE_PROCESS = {THU_BHXH, THAI_SAN, KO_THU};        String[] DANH_SACH_CHI_TIET = {THU_BHXH, THAI_SAN};        String[] THU = {THU_BHXH, TRUY_THU, TRUY_LINH, THAI_SAN, TRUY_THU_BHYT};        String[] THU_KPCD = {THU_BHXH, TRUY_THU, TRUY_LINH, THAI_SAN};        String[] TRUY_THU_LINH = {TRUY_THU, TRUY_LINH};    }    public interface STATUS {        String DU_THAO = "DU_THAO";        String PHE_DUYET = "PHE_DUYET";    }    public void setContributionAmount(ContributionRateEntity rateDto, ContributionParameterDto divisionRatioDto) {        if (rateDto != null && this.totalSalary != 0) {            this.unitSocialAmount = Math.round(Utils.NVL(rateDto.getUnitSocialPercent()) * this.totalSalary / 100);            this.perSocialAmount = Math.round(Utils.NVL(rateDto.getPerSocialPercent()) * this.totalSalary / 100);            this.unitMedicalAmount = Math.round(Utils.NVL(rateDto.getUnitMedicalPercent()) * this.totalSalary / 100);            this.perMedicalAmount = Math.round(Utils.NVL(rateDto.getPerMedicalPercent()) * this.totalSalary / 100);            this.unitUnempAmount = Math.round(Utils.NVL(rateDto.getUnitUnempPercent()) * this.totalSalary / 100);            this.perUnempAmount = Math.round(Utils.NVL(rateDto.getPerUnempPercent()) * this.totalSalary / 100);            this.unitUnionAmount = Math.round(Utils.NVL(rateDto.getUnitUnionPercent()) * this.totalSalary / 100);            this.totalAmount = this.unitSocialAmount + this.perSocialAmount                    + this.unitMedicalAmount + this.perMedicalAmount                    + this.unitUnempAmount + this.perUnempAmount;            this.baseUnionAmount = Math.round(Utils.NVL(divisionRatioDto.getBaseUnionPercent()) * this.unitUnionAmount / 100);            this.superiorUnionAmount = Math.round(Utils.NVL(divisionRatioDto.getSuperiorUnionPercent()) * this.unitUnionAmount / 100);            this.modUnionAmount = this.unitUnionAmount - this.baseUnionAmount - this.superiorUnionAmount;            this.retirementSocialAmount = Math.round(Utils.NVL(divisionRatioDto.getRetirementSocialPercent()) * this.unitSocialAmount / 100);            this.sicknessSocialAmount = Math.round(Utils.NVL(divisionRatioDto.getSicknessSocialPercent()) * this.unitSocialAmount / 100);            this.accidentSocialAmount = this.unitSocialAmount - this.retirementSocialAmount - this.sicknessSocialAmount;        }    }    public void setMedicalAmount(ContributionRateEntity rateDto, boolean isPersonalPayed, boolean isUnitPayed, boolean isInputScreen) throws BaseAppException {        if (rateDto != null && this.totalSalary != 0) {            this.perMedicalAmount = Math.round(Utils.NVL(rateDto.getPerMedicalPercent()) * this.totalSalary / 100);            this.unitMedicalAmount = Math.round(Utils.NVL(rateDto.getUnitMedicalPercent()) * this.totalSalary / 100);            if(isPersonalPayed && !isUnitPayed){                this.perMedicalAmount = this.perMedicalAmount + this.unitMedicalAmount;                this.unitMedicalAmount = 0l;            } else if(!isPersonalPayed && isUnitPayed){                this.unitMedicalAmount = this.perMedicalAmount + this.unitMedicalAmount;                this.perMedicalAmount = 0l;            } else if(!isPersonalPayed && !isUnitPayed && isInputScreen){                throw  new BaseAppException("Phải lựa chọn ít nhất cá nhân hoặc đơn vị thực hiện đóng");            }            this.totalAmount = this.unitMedicalAmount + this.perMedicalAmount;        }    }}