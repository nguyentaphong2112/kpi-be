# 1. Install jdk
   ```
  #bash
  sudo apt update
  sudo apt-get install openjdk-17-jdk
   ```  
# 2. Install Git & gen ssh key
   ```
   #bash
   sudo apt install git
   #gen ssh key
   ssh-keygen -t rsa -b 4096 -C "{account-git}"

   #then add ssh key to gitlab.com : https://gitlab.com/-/user_settings/ssh_keys 
   ```
# 3. Clone code
   ```
   #bash
   cd {directory-save-source}
   git clone git@gitlab.com:hcm-product/backend-service.git
   ```
# 4. Install Nodejs, npm & pm2
   ```
   #bash
   #install node js & npm 
   sudo apt install nodejs npm

   #install pm2
   sudo npm install -g pm2
   ```
# 5. Install & config iptables (trường hợp cần cấu hình)
   ```
   #bash
   #install iptables
   sudo apt install iptables

   #create & custom rule iptables by update file iptables-rules.sh
   cd /etc/
   sudo mkdir iptables
   sudo touch iptables-rules.sh
   sudo touch rules.v4
   sudo touch reset-iptables-rules.sh
   ```
  Edit file  iptables-rules.sh with rules
  ```
  sudo iptables -F
  sudo iptables -P INPUT ACCEPT
  sudo iptables -P FORWARD ACCEPT
  sudo iptables -P OUTPUT DROP
  sudo iptables -A OUTPUT -o lo -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 172.16.1.58 --dport 8629 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 10.8.14.190 --dport 8629 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 172.16.1.61 --dport 2525 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 172.16.1.61 --dport 8025 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 172.16.1.66 --dport 6379 -j ACCEPT
  sudo iptables -A OUTPUT -p tcp -d 172.16.1.61 --dport 25 -j ACCEPT
  
  sudo iptables-save > /etc/iptables/rules.v4
 
  ```
  Edit file reset-iptables-rules.sh
  ```
   sudo iptables -F
   sudo iptables -P INPUT ACCEPT
   sudo iptables -P FORWARD ACCEPT
   sudo iptables -P OUTPUT ACCEPT
   
   sudo iptables-save > /etc/iptables/rules.v4 
   
   #sudo service iptables restart
  ```
  Chmod file iptables-rules.sh & reset-iptables-rules.sh
  ```
  chmod +x /etc/iptables/*
  ```
# 6 Creat file bash to build service
+ Create file build-service.sh
  ```
  sudo sh /etc/iptables/reset-iptables-rules.sh
  #change with path to source
  cd /u01/app/hcm-product/backend/backend-service
  
  #Fetch code from branch develop
  git fetch
  git checkout develop
  git reset --hard HEAD
  git pull  
  
  #Build jar
  mvn clean install
  
  sudo sh /etc/iptables/iptables-rules.sh
  
  for arg in "$@"
  do
      pm2 restart $arg
  done  
  ```
 + Create file start-service.sh
   ```
   #change /u01/app/hcm-product/backend/backend-service/admin-service to path of source
   #Change --spring.profiles.active=dev to the desired Spring profile that you want to deploy
   pm2 start "java -jar /u01/app/hcm-product/backend/backend-service/admin-service/target/admin-service-1.0-SNAPSHOT.jar --spring.profiles.active=dev" -n "admin-service"
   pm2 start "java -jar /u01/app/hcm-product/backend/backend-service/file-storage-service/target/file-storage-service-1.0-SNAPSHOT.jar --spring.profiles.active=uat" -n "file-storage-service"
   pm2 start "java -jar /u01/app/hcm-product/backend/backend-service/library-service/target/library-service-1.0-SNAPSHOT.jar --spring.profiles.active=dev" -n "library-service"
   pm2 start "java -jar /u01/app/hcm-product/backend/backend-service/hrm-service/target/hrm-service-1.0-SNAPSHOT.jar --spring.profiles.active=dev" -n "hrm-service"
   pm2 start "java -jar /u01/app/hcm-product/backend/backend-service/kpi-service/target/kpi-service-1.0-SNAPSHOT.jar --spring.profiles.active=dev" -n "kpi-service"
   
   #pm2 start "java -jar /u01/app/cong-trinh/group-backend/vcc-icn-service/icn-service/target/icn-service-1.0-SNAPSHOT.jar --spring.profiles.active=dev" -n "icn-service"   
   ```
# 7 Build & start service 
   ```
   #chmod file
   chmod +x build-jar.sh
   chmod +x start-service.sh

   # run file to build
   bash build-jar.sh
   # start service
   bash start-service.sh
   # check service running
   pm2 list
   # restart specific service
   pm2 restart {service_id}
   # check log service
   pm2 log {service_id}
   OR chek file log in ~/.pm2/logs/
   # build & restart specific service, change {service_id_1}, {service_id_2},... by service_id that you want to restart
   bash build-service.sh {service_id_1} {service_id_2}
   ```
