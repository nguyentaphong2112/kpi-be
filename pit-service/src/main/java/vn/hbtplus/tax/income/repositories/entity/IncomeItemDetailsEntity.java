/* * Copyright (C) 2022 HBTPlus. All rights reserved. * HBTPlus. Use is subject to license terms. */package vn.hbtplus.tax.income.repositories.entity;import lombok.Data;import vn.hbtplus.repositories.entity.BaseEntity;import vn.hbtplus.utils.Utils;import javax.persistence.*;import java.util.Date;import java.util.HashMap;import java.util.List;import java.util.Map;import vn.hbtplus.tax.income.constants.Constant;/** * Lop entity ung voi bang pit_income_item_details * * @author tudd * @version 1.0 * @since 1.0 */@Data@Entity@Table(name = "pit_income_item_details")public class IncomeItemDetailsEntity extends BaseEntity {    @Id    @GeneratedValue(strategy = GenerationType.IDENTITY)    @Column(name = "income_item_detail_id")    private Long incomeItemDetailId;    @Column(name = "income_item_master_id")    private Long incomeItemMasterId;    @Column(name = "tax_period_date")    @Temporal(TemporalType.DATE)    private Date taxPeriodDate;    @Column(name = "emp_code")    private String empCode;    @Column(name = "full_name")    private String fullName;    @Column(name = "tax_no")    private String taxNo;    @Column(name = "extra_code")    private String extraCode;    @Column(name = "personal_id_no")    private String personalIdNo;    @Column(name = "personal_id_place")    private String personalIdPlace;    @Column(name = "personal_id_date")    @Temporal(TemporalType.DATE)    private Date personalIdDate;    @Column(name = "income_amount")    private Long incomeAmount;    @Column(name = "income_taxable")    private Long incomeTaxable;    @Column(name = "insurance_deduction")    private Long insuranceDeduction;    @Column(name = "other_deduction")    private Long otherDeduction;    @Column(name = "income_free_tax")    private Long incomeFreeTax;    @Column(name = "income_tax")    private Long incomeTax;    @Column(name = "month_retro_tax")    private Long monthRetroTax;    @Column(name = "year_retro_tax")    private Long yearRetroTax;    @Column(name = "order_number")    private Long orderNumber;    @Column(name = "income_received")    private Long incomeReceived;    @Column(name = "declare_org_id")    private Long declareOrgId;    @Column(name = "work_org_id")    private Long workOrgId;    @Column(name = "note")    private String note;    @Column(name = "accounting_income_name")    private String accountingIncomeName;    public IncomeItemDetailsEntity(Date taxPeriodDate) {        this.taxPeriodDate = taxPeriodDate;    }    public IncomeItemDetailsEntity() {    }    @Transient    private Map<String, Long> mapValues = new HashMap<>();    public void addIncomeValue(Map<String, List<String>> mapIncomeTypeColumns, IncomeItemColumnsEntity columnsEntity) {        if (columnsEntity.getColumnValue() != null) {            if (isIncomeType(Constant.IncomeType.TAXABLE, columnsEntity.getColumnCode(), mapIncomeTypeColumns)                    || isIncomeType(Constant.IncomeType.TAX_10, columnsEntity.getColumnCode(), mapIncomeTypeColumns)                    || isIncomeType(Constant.IncomeType.TAX_20, columnsEntity.getColumnCode(), mapIncomeTypeColumns)            ) {                incomeAmount = Utils.NVL(incomeAmount) + columnsEntity.getColumnValue();                incomeTaxable = Utils.NVL(incomeTaxable) + columnsEntity.getColumnValue();            } else if (isIncomeType(Constant.IncomeType.NON_TAX, columnsEntity.getColumnCode(), mapIncomeTypeColumns)) {                incomeAmount = Utils.NVL(incomeAmount) + columnsEntity.getColumnValue();                incomeFreeTax = Utils.NVL(incomeFreeTax) + columnsEntity.getColumnValue();            } else if (isIncomeType(Constant.IncomeType.DEDUCT, columnsEntity.getColumnCode(), mapIncomeTypeColumns)) {                insuranceDeduction = Utils.NVL(insuranceDeduction) + columnsEntity.getColumnValue();            } else if (isIncomeType(Constant.IncomeType.MINIMUM, columnsEntity.getColumnCode(), mapIncomeTypeColumns)) {                incomeAmount = Utils.NVL(incomeAmount) + columnsEntity.getColumnValue();                incomeTaxable = Utils.NVL(incomeTaxable) + columnsEntity.getColumnValue();                otherDeduction = Utils.NVL(otherDeduction) + columnsEntity.getColumnValue();            }            incomeReceived = Utils.NVL(incomeAmount)                    - Utils.NVL(insuranceDeduction)                    - Utils.NVL(incomeTax)                    - Utils.NVL(monthRetroTax)                    - Utils.NVL(yearRetroTax);        }    }    private boolean isIncomeType(String incomeType, String columnCode, Map<String, List<String>> mapIncomeTypeColumns) {        if (mapIncomeTypeColumns.get(incomeType) != null                && mapIncomeTypeColumns.get(incomeType).contains(columnCode)) {            return true;        }        return false;    }}